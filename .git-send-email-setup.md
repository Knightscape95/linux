# Git Send-Email Setup Guide for Linux Kernel Development

This guide helps you configure `git send-email` to send patches to Linux kernel maintainers.

## Prerequisites

✓ git send-email is installed at: `/usr/local/bin/git-send-email`
✓ Perl dependencies installed (Email::Valid, Mail::*, etc.)

## Quick Setup

### 1. Configure Your Email Identity

```bash
# Set your name and email (if not already set)
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"
```

### 2. Configure SMTP Settings

Choose one of the following configurations based on your email provider:

#### Option A: Gmail

```bash
git config --global sendemail.smtpserver smtp.gmail.com
git config --global sendemail.smtpserverport 587
git config --global sendemail.smtpencryption tls
git config --global sendemail.smtpuser your.email@gmail.com
```

**Note for Gmail:** You need to use an "App Password" instead of your regular password.
1. Go to Google Account settings → Security → 2-Step Verification → App passwords
2. Generate an app password for "Mail"
3. Use this password when git send-email prompts for it

#### Option B: Outlook/Microsoft 365

```bash
git config --global sendemail.smtpserver smtp-mail.outlook.com
git config --global sendemail.smtpserverport 587
git config --global sendemail.smtpencryption tls
git config --global sendemail.smtpuser your.email@outlook.com
```

#### Option C: Generic SMTP

```bash
git config --global sendemail.smtpserver smtp.yourdomain.com
git config --global sendemail.smtpserverport 587
git config --global sendemail.smtpencryption tls
git config --global sendemail.smtpuser your.email@yourdomain.com
```

#### Option D: Custom SMTP (for advanced users)

```bash
# For sendmail or other local MTA
git config --global sendemail.smtpserver /usr/sbin/sendmail
```

### 3. Configure Additional Send-Email Settings

```bash
# Always CC yourself to keep track of sent patches
git config --global sendemail.cc your.email@example.com

# Confirm before sending each email (recommended for beginners)
git config --global sendemail.confirm always

# Suppress CC list confirmation
git config --global sendemail.suppresscc self

# Use threads for patch series
git config --global sendemail.chainreplyto false
git config --global sendemail.thread true

# Add signed-off-by line automatically
git config --global format.signoff true
```

### 4. Verify Configuration

```bash
git config --global --list | grep sendemail
```

## Workflow: Sending Patches to Maintainers

### Step 1: Identify Maintainers

Use the `get_maintainer.pl` script to find who should receive your patch:

```bash
# For a specific file
./scripts/get_maintainer.pl -f drivers/net/ethernet/intel/igc/igc_main.c

# For your patch
git format-patch -1 --stdout | ./scripts/get_maintainer.pl
```

### Step 2: Create Patches

```bash
# Single commit patch
git format-patch -1

# Last N commits
git format-patch -n

# Patch series with cover letter
git format-patch -3 --cover-letter
```

### Step 3: Review and Edit Patches

- Edit `0000-cover-letter.patch` if using cover letter
- Review each `.patch` file to ensure formatting is correct
- Add any additional context needed

### Step 4: Send Patches

```bash
# Send single patch
git send-email --to maintainer@example.com \
               --cc linux-kernel@vger.kernel.org \
               0001-your-patch.patch

# Send patch series
git send-email --to maintainer@example.com \
               --cc linux-kernel@vger.kernel.org \
               --cc linux-netdev@vger.kernel.org \
               *.patch
```

**Using get_maintainer.pl output:**

```bash
# Get maintainers and save to variable
MAINTAINERS=$(./scripts/get_maintainer.pl 0001-your-patch.patch)

# Send with automatic CC to maintainers
git send-email --to-cmd='./scripts/get_maintainer.pl --to' \
               --cc-cmd='./scripts/get_maintainer.pl --cc' \
               0001-your-patch.patch
```

### Step 5: Test First!

**IMPORTANT:** Always test by sending to yourself first:

```bash
git send-email --to your.email@example.com 0001-test-patch.patch
```

Verify the email arrives correctly and formatting is preserved.

## Common Options

```bash
# Dry run (don't actually send)
git send-email --dry-run *.patch

# Add in-reply-to header (for patch revisions)
git send-email --in-reply-to="<message-id@example.com>" *.patch

# Subject prefix for revisions
git send-email --subject-prefix="PATCH v2" *.patch

# Suppress CC to certain people
git send-email --suppress-cc=all *.patch
```

## Troubleshooting

### Password Storage

To avoid entering password every time:

```bash
# Install git credential helper
sudo apt-get install git-credential-libsecret

# Configure git to use it
git config --global credential.helper libsecret
```

Or use `~/.git-credentials` (less secure):

```bash
git config --global credential.helper store
# First use will prompt and save credentials
```

### SSL Certificate Issues

```bash
git config --global sendemail.smtpssl false
git config --global sendemail.smtpsslcertpath /etc/ssl/certs
```

### Testing SMTP Connection

```bash
# Use Perl to test SMTP
perl -MMIME::Base64 -MNet::SMTP::SSL -e '
  my $smtp = Net::SMTP::SSL->new("smtp.gmail.com", Port => 465) or die $!;
  $smtp->auth("user", "password") or die $smtp->message;
  print "Success!\n";
'
```

## Patch Best Practices

1. **Keep patches focused**: One logical change per patch
2. **Write good commit messages**: 
   - Short summary line (< 70 chars)
   - Blank line
   - Detailed description
   - Signed-off-by line
3. **Test your patches**: Compile and test before sending
4. **Run checkpatch.pl**: `./scripts/checkpatch.pl your.patch`
5. **Follow coding style**: See Documentation/process/coding-style.rst

## Example Workflow

```bash
# 1. Make your changes
git add drivers/net/ethernet/intel/igc/igc_main.c

# 2. Commit with good message
git commit -s -m "igc: Fix PCIe link recovery issue

Add retry logic to handle temporary PCIe link failures.
This prevents permanent device detachment on transient errors.

Signed-off-by: Your Name <your.email@example.com>"

# 3. Create patch
git format-patch -1

# 4. Check patch style
./scripts/checkpatch.pl 0001-*.patch

# 5. Find maintainers
./scripts/get_maintainer.pl 0001-*.patch

# 6. Test send to yourself
git send-email --to your.email@example.com 0001-*.patch

# 7. Send to maintainers (after testing)
git send-email --to-cmd='./scripts/get_maintainer.pl --to' \
               --cc-cmd='./scripts/get_maintainer.pl --cc' \
               0001-*.patch
```

## References

- Git send-email documentation: `man git-send-email`
- Interactive tutorial: https://git-send-email.io
- Kernel documentation:
  - Documentation/process/submitting-patches.rst
  - Documentation/process/email-clients.rst
  - Documentation/process/5.Posting.rst

## Quick Reference Card

```bash
# Configure
git config --global sendemail.smtpserver smtp.gmail.com
git config --global sendemail.smtpuser your.email@gmail.com

# Create patches
git format-patch -1           # Last commit
git format-patch HEAD~3       # Last 3 commits
git format-patch --cover-letter HEAD~3  # With cover letter

# Find maintainers
./scripts/get_maintainer.pl -f <file>
./scripts/get_maintainer.pl <patch>

# Send patches
git send-email *.patch
git send-email --to maintainer@example.com *.patch
git send-email --to-cmd='./scripts/get_maintainer.pl --to' *.patch

# Common flags
--dry-run              # Test without sending
--confirm=always       # Confirm each email
--subject-prefix="PATCH v2"  # For revisions
--in-reply-to="<msg-id>"     # Reply to thread
```

## Support

If you encounter issues:
1. Check git configuration: `git config --list | grep sendemail`
2. Test SMTP connection independently
3. Verify email arrives when sending to yourself
4. Check kernel mailing list archives to see how others send patches
5. Ask on #kernelnewbies IRC channel or kernelnewbies@kernelnewbies.org
